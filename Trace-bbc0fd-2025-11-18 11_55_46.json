{"batches":[{"resource":{"attributes":[{"key":"telemetry.sdk.language","value":{"stringValue":"python"}},{"key":"telemetry.sdk.name","value":{"stringValue":"opentelemetry"}},{"key":"telemetry.sdk.version","value":{"stringValue":"1.20.0"}},{"key":"service.version","value":{"stringValue":"1.0.0"}},{"key":"deployment.environment","value":{"stringValue":"hcb-dev"}},{"key":"k8s.pod.ip","value":{"stringValue":"100.95.206.4"}},{"key":"cloud.provider","value":{"stringValue":"gcp"}},{"key":"cloud.account.id","value":{"stringValue":"anbc-hcb-dev"}},{"key":"cloud.platform","value":{"stringValue":"gcp_kubernetes_engine"}},{"key":"cloud.availability_zone","value":{"stringValue":"us-east4-a"}},{"key":"host.id","value":{"stringValue":"2075734452852721412"}},{"key":"host.name","value":{"stringValue":"gke-io-hcb-dev-default-f-cc51fb65-qqcd"}},{"key":"service.name","value":{"stringValue":"APM0016344"}},{"key":"k8s.cluster.name","value":{"stringValue":"io-hcb-dev"}}],"droppedAttributesCount":0},"instrumentationLibrarySpans":[{"spans":[{"traceId":"5128a8009a7b436ca3ff0f408cbbc0fd","spanId":"4f3ce5d8a66cc581","parentSpanId":"0000000000000000","traceState":"","name":"POST /costestimator/v1/rate","kind":"SPAN_KIND_SERVER","startTimeUnixNano":1763484321864852200,"endTimeUnixNano":1763484321977555700,"attributes":[{"key":"http.scheme","value":{"stringValue":"http"}},{"key":"http.host","value":{"stringValue":"100.95.217.102:8000"}},{"key":"net.host.port","value":{"intValue":8000}},{"key":"http.flavor","value":{"stringValue":"1.1"}},{"key":"http.target","value":{"stringValue":"/costestimator/v1/rate"}},{"key":"http.server_name","value":{"stringValue":"cost-estimator-calc-service.hcb-dev.aig.aetna.com"}},{"key":"http.user_agent","value":{"stringValue":"axios/1.11.0"}},{"key":"net.peer.ip","value":{"stringValue":"127.0.0.6"}},{"key":"net.peer.port","value":{"intValue":59799}},{"key":"http.route","value":{"stringValue":"/costestimator/v1/rate"}},{"key":"otel.collector","value":{"stringValue":"processed"}},{"key":"http.method","value":{"stringValue":"POST"}},{"key":"http.url","value":{"stringValue":"http://100.95.217.102:8000/costestimator/v1/rate"}}],"droppedAttributesCount":0,"droppedEventsCount":0,"droppedLinksCount":0,"status":{"code":2,"message":"ValueError: Header x-eieusercontext is required"},"events":[{"timeUnixNano":1763484321977542400,"attributes":[{"key":"exception.type","value":{"stringValue":"ValueError"}},{"key":"exception.message","value":{"stringValue":"Header x-eieusercontext is required"}},{"key":"exception.stacktrace","value":{"stringValue":"Traceback (most recent call last):\n  File \"/usr/local/lib/python3.10/site-packages/opentelemetry/trace/__init__.py\", line 573, in use_span\n    yield span\n  File \"/usr/local/lib/python3.10/site-packages/opentelemetry/instrumentation/asgi/__init__.py\", line 596, in __call__\n    await self.app(scope, otel_receive, otel_send)\n  File \"/usr/local/lib/python3.10/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.10/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.10/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.10/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.10/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.10/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.10/site-packages/fastapi/routing.py\", line 123, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.10/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.10/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.10/site-packages/fastapi/routing.py\", line 109, in app\n    response = await f(request)\n  File \"/usr/local/lib/python3.10/site-packages/fastapi/routing.py\", line 389, in app\n    raw_response = await run_endpoint_function(\n  File \"/usr/local/lib/python3.10/site-packages/fastapi/routing.py\", line 288, in run_endpoint_function\n    return await dependant.call(**values)\n  File \"/app/app/core/observability/tracing/tracing_decorators.py\", line 72, in async_wrapper\n    result = await func(*args, **kwargs)\n  File \"/app/app/api/v1/routes/requests.py\", line 43, in estimate_cost\n    response = await cost_estimation_service.estimate_cost(request, headers=headers)\n  File \"/app/app/services/impl/cost_estimation_service_impl.py\", line 73, in estimate_cost\n    gathered_result = await asyncio.gather(\n  File \"/app/app/core/circuitbreaker/circuit_breaker.py\", line 86, in async_wrapper\n    return await cb.call_async(func, *args, **kwargs)\n  File \"/usr/local/lib/python3.10/site-packages/circuitbreaker.py\", line 207, in call_async\n    return await func(*args, **kwargs)\n  File \"/usr/local/lib/python3.10/site-packages/tenacity/_asyncio.py\", line 88, in async_wrapped\n    return await fn(*args, **kwargs)\n  File \"/usr/local/lib/python3.10/site-packages/tenacity/_asyncio.py\", line 47, in __call__\n    do = self.iter(retry_state=retry_state)\n  File \"/usr/local/lib/python3.10/site-packages/tenacity/__init__.py\", line 314, in iter\n    return fut.result()\n  File \"/usr/local/lib/python3.10/concurrent/futures/_base.py\", line 451, in result\n    return self.__get_result()\n  File \"/usr/local/lib/python3.10/concurrent/futures/_base.py\", line 403, in __get_result\n    raise self._exception\n  File \"/usr/local/lib/python3.10/site-packages/tenacity/_asyncio.py\", line 50, in __call__\n    result = await fn(*args, **kwargs)\n  File \"/app/app/core/observability/metrics/metrics_decorators.py\", line 50, in async_wrapper\n    result = await func(*args, **kwargs)\n  File \"/app/app/services/impl/accumulator_service_impl.py\", line 180, in get_accumulator\n    raise e\n  File \"/app/app/services/impl/accumulator_service_impl.py\", line 82, in get_accumulator\n    xml_request = request_builder.build_xml_request(request, headers)\n  File \"/app/app/schemas/accumulator_request.py\", line 60, in build_xml_request\n    raise ValueError(f\"Header {key} is required\")\nValueError: Header x-eieusercontext is required\n"}},{"key":"exception.escaped","value":{"stringValue":"False"}}],"droppedAttributesCount":0,"name":"exception"}]}],"instrumentationLibrary":{"name":"opentelemetry.instrumentation.asgi","version":"0.41b0"}}]},{"resource":{"attributes":[{"key":"telemetry.sdk.language","value":{"stringValue":"python"}},{"key":"telemetry.sdk.name","value":{"stringValue":"opentelemetry"}},{"key":"telemetry.sdk.version","value":{"stringValue":"1.20.0"}},{"key":"service.version","value":{"stringValue":"1.0.0"}},{"key":"deployment.environment","value":{"stringValue":"hcb-dev"}},{"key":"k8s.pod.ip","value":{"stringValue":"100.95.206.4"}},{"key":"cloud.provider","value":{"stringValue":"gcp"}},{"key":"cloud.account.id","value":{"stringValue":"anbc-hcb-dev"}},{"key":"cloud.platform","value":{"stringValue":"gcp_kubernetes_engine"}},{"key":"cloud.availability_zone","value":{"stringValue":"us-east4-a"}},{"key":"host.id","value":{"stringValue":"2075734452852721412"}},{"key":"host.name","value":{"stringValue":"gke-io-hcb-dev-default-f-cc51fb65-qqcd"}},{"key":"service.name","value":{"stringValue":"APM0016344"}},{"key":"k8s.cluster.name","value":{"stringValue":"io-hcb-dev"}}],"droppedAttributesCount":0},"instrumentationLibrarySpans":[{"spans":[{"traceId":"5128a8009a7b436ca3ff0f408cbbc0fd","spanId":"609f31fdb8bb9b14","parentSpanId":"4f3ce5d8a66cc581","traceState":"","name":"POST /costestimator/v1/rate http receive","kind":"SPAN_KIND_INTERNAL","startTimeUnixNano":1763484321865181400,"endTimeUnixNano":1763484321865216300,"attributes":[{"key":"type","value":{"stringValue":"http.request"}},{"key":"otel.collector","value":{"stringValue":"processed"}}],"droppedAttributesCount":0,"droppedEventsCount":0,"droppedLinksCount":0,"status":{"code":0,"message":""}},{"traceId":"5128a8009a7b436ca3ff0f408cbbc0fd","spanId":"524203c878d4c58a","parentSpanId":"4f3ce5d8a66cc581","traceState":"","name":"cost_estimation_endpoint","kind":"SPAN_KIND_INTERNAL","startTimeUnixNano":1763484321865741800,"endTimeUnixNano":1763484321977053000,"attributes":[{"key":"request.num_args","value":{"intValue":0}},{"key":"request.num_kwargs","value":{"intValue":2}},{"key":"request.membership_id","value":{"stringValue":"59~101114536600+000003-TX000008+2020-01-01"}},{"key":"request.benefit_product_type","value":{"stringValue":"Medical"}},{"key":"request.num_providers","value":{"intValue":5}},{"key":"request.service_code","value":{"stringValue":"27498"}},{"key":"request.body","value":{"stringValue":"{\"membershipId\": \"59~101114536600+000003-TX000008+2020-01-01\", \"benefitProductType\": \"Medical\", \"service\": {\"code\": \"27498\", \"type\": \"CPT4\", \"description\": \"\"}, \"providerInfo\": [{\"serviceLocation\": \"9094440\", \"providerType\": \"PH\"}, {\"serviceLocation\": \"0654531\", \"providerType\": \"PH\"}, {\"serviceLocation\": \"0654531\", \"providerType\": \"PH\"}, {\"serviceLocation\": \"9094440\", \"providerType\": \"PH\"}, {\"serviceLocation\": \"0654531\", \"providerType\": \"PH\"}]}"}},{"key":"request.header.x_global_transaction_id","value":{"stringValue":"74936a90691ca2a0fdae2c5f"}},{"key":"request.header.x_clientrefid","value":{"stringValue":"AetnaHealthCostTransparencyService"}},{"key":"request.header.content_type","value":{"stringValue":"application/json"}},{"key":"request.headers_count","value":{"intValue":3}},{"key":"request.headers_summary","value":{"stringValue":"x-global-transaction-id: 74936a90691ca2a0fdae2c5f; x-clientrefid: AetnaHealthCostTransparencyService; content-type: application/json"}},{"key":"x.global.transaction.id","value":{"stringValue":"74936a90691ca2a0fdae2c5f"}},{"key":"http.path","value":{"stringValue":"/costestimator/v1/rate"}},{"key":"http.query_params","value":{"stringValue":""}},{"key":"http.client_ip","value":{"stringValue":"127.0.0.6"}},{"key":"error.message","value":{"stringValue":"Header x-eieusercontext is required"}},{"key":"error.type","value":{"stringValue":"ValueError"}},{"key":"function.duration_ms","value":{"doubleValue":110.21}},{"key":"function.name","value":{"stringValue":"estimate_cost"}},{"key":"function.module","value":{"stringValue":"app.api.v1.routes.requests"}},{"key":"otel.collector","value":{"stringValue":"processed"}},{"key":"http.method","value":{"stringValue":"POST"}},{"key":"http.url","value":{"stringValue":"http://cost-estimator-calc-service.hcb-dev.aig.aetna.com/costestimator/v1/rate"}}],"droppedAttributesCount":0,"droppedEventsCount":0,"droppedLinksCount":0,"status":{"code":2,"message":"ValueError: Header x-eieusercontext is required"},"events":[{"timeUnixNano":1763484321977026300,"attributes":[{"key":"exception.type","value":{"stringValue":"ValueError"}},{"key":"exception.message","value":{"stringValue":"Header x-eieusercontext is required"}},{"key":"exception.stacktrace","value":{"stringValue":"Traceback (most recent call last):\n  File \"/usr/local/lib/python3.10/site-packages/opentelemetry/trace/__init__.py\", line 573, in use_span\n    yield span\n  File \"/usr/local/lib/python3.10/site-packages/opentelemetry/sdk/trace/__init__.py\", line 1045, in start_as_current_span\n    yield span_context\n  File \"/app/app/core/observability/tracing/tracing_decorators.py\", line 72, in async_wrapper\n    result = await func(*args, **kwargs)\n  File \"/app/app/api/v1/routes/requests.py\", line 43, in estimate_cost\n    response = await cost_estimation_service.estimate_cost(request, headers=headers)\n  File \"/app/app/services/impl/cost_estimation_service_impl.py\", line 73, in estimate_cost\n    gathered_result = await asyncio.gather(\n  File \"/app/app/core/circuitbreaker/circuit_breaker.py\", line 86, in async_wrapper\n    return await cb.call_async(func, *args, **kwargs)\n  File \"/usr/local/lib/python3.10/site-packages/circuitbreaker.py\", line 207, in call_async\n    return await func(*args, **kwargs)\n  File \"/usr/local/lib/python3.10/site-packages/tenacity/_asyncio.py\", line 88, in async_wrapped\n    return await fn(*args, **kwargs)\n  File \"/usr/local/lib/python3.10/site-packages/tenacity/_asyncio.py\", line 47, in __call__\n    do = self.iter(retry_state=retry_state)\n  File \"/usr/local/lib/python3.10/site-packages/tenacity/__init__.py\", line 314, in iter\n    return fut.result()\n  File \"/usr/local/lib/python3.10/concurrent/futures/_base.py\", line 451, in result\n    return self.__get_result()\n  File \"/usr/local/lib/python3.10/concurrent/futures/_base.py\", line 403, in __get_result\n    raise self._exception\n  File \"/usr/local/lib/python3.10/site-packages/tenacity/_asyncio.py\", line 50, in __call__\n    result = await fn(*args, **kwargs)\n  File \"/app/app/core/observability/metrics/metrics_decorators.py\", line 50, in async_wrapper\n    result = await func(*args, **kwargs)\n  File \"/app/app/services/impl/accumulator_service_impl.py\", line 180, in get_accumulator\n    raise e\n  File \"/app/app/services/impl/accumulator_service_impl.py\", line 82, in get_accumulator\n    xml_request = request_builder.build_xml_request(request, headers)\n  File \"/app/app/schemas/accumulator_request.py\", line 60, in build_xml_request\n    raise ValueError(f\"Header {key} is required\")\nValueError: Header x-eieusercontext is required\n"}},{"key":"exception.escaped","value":{"stringValue":"False"}}],"droppedAttributesCount":0,"name":"exception"}]},{"traceId":"5128a8009a7b436ca3ff0f408cbbc0fd","spanId":"4ad8c5c02c24778b","parentSpanId":"524203c878d4c58a","traceState":"","name":"POST","kind":"SPAN_KIND_CLIENT","startTimeUnixNano":1763484321867161300,"endTimeUnixNano":1763484321968102700,"attributes":[{"key":"otel.collector","value":{"stringValue":"processed"}},{"key":"http.method","value":{"stringValue":"POST"}},{"key":"http.url","value":{"stringValue":"https://qaapi01.int.aetna.com/healthcare/qapath2/v5/privapp/auth/oauth2/token"}},{"key":"http.status_code","value":{"intValue":200}}],"droppedAttributesCount":0,"droppedEventsCount":0,"droppedLinksCount":0,"status":{"code":0,"message":""}},{"traceId":"5128a8009a7b436ca3ff0f408cbbc0fd","spanId":"be72df2056680009","parentSpanId":"524203c878d4c58a","traceState":"","name":"POST","kind":"SPAN_KIND_CLIENT","startTimeUnixNano":1763484321971970300,"endTimeUnixNano":1763484322160608000,"attributes":[{"key":"otel.collector","value":{"stringValue":"processed"}},{"key":"http.method","value":{"stringValue":"POST"}},{"key":"http.url","value":{"stringValue":"https://qaapi01.int.aetna.com/hcb/qapath2/hcb/v4/internal/servicesbenefits/details/retrieve"}},{"key":"http.status_code","value":{"intValue":500}}],"droppedAttributesCount":0,"droppedEventsCount":0,"droppedLinksCount":0,"status":{"code":2,"message":""}},{"traceId":"5128a8009a7b436ca3ff0f408cbbc0fd","spanId":"1b951dbc174e5b29","parentSpanId":"524203c878d4c58a","traceState":"","name":"POST","kind":"SPAN_KIND_CLIENT","startTimeUnixNano":1763484321972783400,"endTimeUnixNano":1763484322256876800,"attributes":[{"key":"otel.collector","value":{"stringValue":"processed"}},{"key":"http.method","value":{"stringValue":"POST"}},{"key":"http.url","value":{"stringValue":"https://qaapi01.int.aetna.com/hcb/qapath2/hcb/v4/internal/servicesbenefits/details/retrieve"}},{"key":"http.status_code","value":{"intValue":500}}],"droppedAttributesCount":0,"droppedEventsCount":0,"droppedLinksCount":0,"status":{"code":2,"message":""}},{"traceId":"5128a8009a7b436ca3ff0f408cbbc0fd","spanId":"b576e3569d044563","parentSpanId":"524203c878d4c58a","traceState":"","name":"POST","kind":"SPAN_KIND_CLIENT","startTimeUnixNano":1763484321973494300,"endTimeUnixNano":1763484322227172600,"attributes":[{"key":"otel.collector","value":{"stringValue":"processed"}},{"key":"http.method","value":{"stringValue":"POST"}},{"key":"http.url","value":{"stringValue":"https://qaapi01.int.aetna.com/hcb/qapath2/hcb/v4/internal/servicesbenefits/details/retrieve"}},{"key":"http.status_code","value":{"intValue":500}}],"droppedAttributesCount":0,"droppedEventsCount":0,"droppedLinksCount":0,"status":{"code":2,"message":""}},{"traceId":"5128a8009a7b436ca3ff0f408cbbc0fd","spanId":"088d4d960a8c19f2","parentSpanId":"524203c878d4c58a","traceState":"","name":"POST","kind":"SPAN_KIND_CLIENT","startTimeUnixNano":1763484321974193200,"endTimeUnixNano":1763484322197027300,"attributes":[{"key":"otel.collector","value":{"stringValue":"processed"}},{"key":"http.method","value":{"stringValue":"POST"}},{"key":"http.url","value":{"stringValue":"https://qaapi01.int.aetna.com/hcb/qapath2/hcb/v4/internal/servicesbenefits/details/retrieve"}},{"key":"http.status_code","value":{"intValue":500}}],"droppedAttributesCount":0,"droppedEventsCount":0,"droppedLinksCount":0,"status":{"code":2,"message":""}},{"traceId":"5128a8009a7b436ca3ff0f408cbbc0fd","spanId":"2646a8dbcc2569e1","parentSpanId":"524203c878d4c58a","traceState":"","name":"POST","kind":"SPAN_KIND_CLIENT","startTimeUnixNano":1763484321975038000,"endTimeUnixNano":1763484322200126700,"attributes":[{"key":"otel.collector","value":{"stringValue":"processed"}},{"key":"http.method","value":{"stringValue":"POST"}},{"key":"http.url","value":{"stringValue":"https://qaapi01.int.aetna.com/hcb/qapath2/hcb/v4/internal/servicesbenefits/details/retrieve"}},{"key":"http.status_code","value":{"intValue":500}}],"droppedAttributesCount":0,"droppedEventsCount":0,"droppedLinksCount":0,"status":{"code":2,"message":""}}],"instrumentationLibrary":{"name":"opentelemetry.instrumentation.asgi","version":"0.41b0"}}]}]}